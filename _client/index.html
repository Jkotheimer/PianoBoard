<!DOCTYPE html>
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>PianoBoard Login</title>
	<link rel="icon" href="/images/favicon-32.png" type="image/png"/>
	<link href="https://fonts.googleapis.com/css?family=Kalam&display=swap" rel="stylesheet"/>
	<link href="https://fonts.googleapis.com/css?family=Exo&display=swap" rel="stylesheet"/>
	<link rel="stylesheet" href="/UI/css/variables.css"/>
	<link rel="stylesheet" href="login_page.css"/>
</head>
<body>
	<div class="panel">
		<div class="logo">
			<img src="/UI/images/logo.png"/>
		</div>

		<div class="link_area">
			<a href="./create_account" class="link ca_link">Create a new Account</a>
			<a href="./reset_password" class="link rp_link">Forgot password?</a>
			<div class="link s_link" onclick="login()">Sign In</div>
		</div>

		<div class="form_area">

			<div class="form_section">
				<div class="form_label">Email</div>
				<input type="text" id="email" class="form_input" placeholder="Enter your email"
					autocapitalize="off" autocomplete="off" spellcheck="false" autocorrect="off" required/>
				<div id="email_notification"></div>
			</div>
			<div class="form_section">
				<div class="form_label">Password</div>
				<input type="password" id="password" class="form_input" placeholder="Enter your password" minlength="8"
					autocapitalize="off" autocomplete="off" spellcheck="false" autocorrect="off" required/>
				<div id="password_notification"></div>
			</div>
		</div>
	</div>

	<div class="info">
		Developed and maintained by Jack Kotheimer
		<br/>
		To learn more about me, visit my <a href="http://67.162.86.57">personal website</a>
	</div>

	<script>
		document.addEventListener("keydown", function() {
			if(event.keyCode == 13) {
				event.preventDefault();
				login();
			}
			else if(event.keyCode == 9 && document.activeElement.name == "password") {
				event.preventDefault();
				document.activeElement = document.getElementById("submit");
			}
		});

		function login() {
			var email = document.getElementById("email").value;
			var password = document.getElementById("password").value;
			var data = JSON.stringify({
				"email" : email,
				"username" : email,
				"password" : password
			});

			var xhr = new XMLHttpRequest();
			xhr.open("POST", "http://localhost/api/authentication/login", true);
			xhr.setRequestHeader("Content-Type", "application/json");
			xhr.onload = function() {
				if(xhr.status == 500) {
					// TODO display errors
					console.log(xhr.response);
				} else if(xhr.status == 404) {
					console.log(xhr.response);
				} else if(xhr.status == 401) {
					console.log(xhr.response);
				}
				else if(xhr.status == 201) {
					localStorage.setItem("account", xhr.response);
					console.log(xhr.response);
					//window.location.href = "/dashboard";
				}
			}
			xhr.send(data);
		}
	</script>
</body>
